import{a as R,_ as m}from"./@babel-AtFDC0j3.js";import{r as s,j as u,a as N}from"./react-DShcIP8I.js";var T={textAnchor:"middle",fontSize:"inherit",fill:"currentColor"},O=t=>{var{weekLabels:a=[],rectSize:e=0,topPad:l=0,space:r=0}=t;return s.useMemo(()=>u.jsx(s.Fragment,{children:[...Array(7)].map((i,n)=>a&&a[n]?u.jsx("text",{className:"w-heatmap-week",x:15,y:l,dy:(n+1)*(e+r)-5,style:T,children:a[n]},n):null)}),[e,r,l,a])},C=24*60*60*1e3;function L(t){return t instanceof Date&&!isNaN(t.getTime())}function k(t){return t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()}function W(t){t===void 0&&(t=[]);var a={};return t.forEach(e=>{e.date&&L(new Date(e.date))&&(e.date=k(new Date(e.date)),a[e.date]=e)}),a}function J(t){return t===void 0&&(t=[]),t.sort((a,e)=>a<e?-1:a>e?1:0)}function V(t,a,e){t===void 0&&(t=0),e===void 0&&(e={});for(var l="",r=0;r<a.length;r+=1){if(a[r]>t){l=e[a[r]];break}l=e[a[r]]}return l}var $=t=>{var{monthLabels:a=[],rectSize:e=0,space:l=0,leftPad:r=0,colNum:i=0,rectY:n=15,startDate:h}=t,f=s.useMemo(()=>a===!1||i<1?[]:[...Array(i*7)].map((d,o)=>{if(o/7%1===0){var v=new Date(h.getTime()+o*C),c=v.getMonth();return{col:o/7,index:o,month:c,day:v.getDate(),monthStr:a[c],date:v}}return null}).filter(Boolean).filter((d,o,v)=>v[o-1]&&v[o-1].month!==d.month),[i,a,h]);return u.jsx(s.Fragment,{children:[...f].map((d,o)=>u.jsx("text",{"data-size":e,x:r+l+l,y:n,dx:d.col*(e+l),textAnchor:"start",style:T,children:d.monthStr},o))})},G=["style","value","render","key"],_=t=>{var{style:a,value:e,render:l}=t,r=R(t,G),i=m({},r,{style:m({display:"block",cursor:"pointer"},a)});if(l&&typeof l=="function"){var n=l(m({},i),e);if(n&&N.isValidElement(n))return n}return u.jsx("rect",m({},i))},H=["panelColors","leftPad","topPad","rectY","space","rectSize","legendCellSize","legendRender"];function I(t){var{panelColors:a,leftPad:e=0,topPad:l=0,rectY:r=15,space:i=0,rectSize:n=0,legendCellSize:h=0,legendRender:f}=t,d=R(t,H),o=h||n;return s.useMemo(()=>u.jsx(s.Fragment,{children:Object.keys(a||{}).map((v,c)=>{var g=m({},d,{key:c,x:(o+1)*c+e,y:r,fill:a[Number(v)],width:o,height:o});return f?f(g):s.createElement(_,m({},g,{key:c}))})}),[a,d,o,r,e,n,f])}var q=t=>{var{transform:a,gridNum:e=0,startY:l=0,panelColors:r={},initStartDate:i,space:n=2,value:h=[],rectSize:f=11,endDate:d,rectProps:o,rectRender:v}=t,c=s.useMemo(()=>W(h),[h]),g=s.useMemo(()=>J(Object.keys(r).map(j=>parseInt(j,10))),[r]);return u.jsx("g",{transform:a,children:e>0&&[...Array(e)].map((j,D)=>u.jsx("g",{"data-column":D,children:[...Array(7)].map((E,S)=>{var b=new Date(i.getTime()+C*(D*7+S)),p=k(b),y=m({},c[p],{date:p,row:S,column:D,index:D*7+S}),P=m({},o,{fill:"var(--rhm-rect, #EBEDF0)",width:f,height:f,x:D*(f+n),y:(f+n)*S,render:v,value:y});return d instanceof Date&&b.getTime()>d.getTime()?null:(p&&c[p]&&r&&Object.keys(r).length>0?P.fill=V(c[p].count||0,g,r):r&&r[0]&&(P.fill=r[0]),s.createElement(_,m({},P,{key:S,value:y,"data-date":p,"data-index":y.index,"data-row":y.row,"data-column":y.column})))})},D))})},K=["rectSize","legendCellSize","space","monthPlacement","startDate","endDate","rectProps","rectRender","legendRender","value","weekLabels","monthLabels","panelColors","style"];function Q(t){var a=t||{},{rectSize:e=11,legendCellSize:l=11,space:r=2,monthPlacement:i="top",startDate:n=new Date,endDate:h,rectProps:f,rectRender:d,legendRender:o,value:v=[],weekLabels:c=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthLabels:g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],panelColors:j={0:"var(--rhm-rect, #EBEDF0)",8:"#7BC96F",4:"#C6E48B",12:"#239A3B",32:"#196127"},style:D}=a,E=R(a,K),[S,b]=s.useState(0),[p,y]=s.useState(c?28:5),P=i==="top"?20:5,[x,A]=s.useState(g?P:5),z=N.createRef();s.useEffect(()=>y(c?28:5),[c]),s.useEffect(()=>{if(z.current){var w=z.current.clientWidth-p||0;b(Math.floor(w/(e+r))||0)}},[e,z,r,p]),s.useEffect(()=>{A(g?P:5)},[g]);var M=s.useMemo(()=>{if(L(n))return n.getDay()?new Date(n.getTime()-n.getDay()*C):n;var w=new Date;return new Date(w.getTime()-w.getDay()*C)},[n]),F={color:"var(--rhm-text-color, #24292e)",userSelect:"none",display:"block",fontSize:10},Y=i==="top"?15:15*7+r,B=i==="top"?x+e*8+6:(g?x+e+r:x)+e*8+6;return u.jsxs("svg",m({ref:z,style:m({},F,D)},E,{children:[l!==0&&u.jsx(I,{legendRender:o,panelColors:j,rectSize:e,rectY:B,legendCellSize:l,leftPad:p,topPad:x,space:r}),u.jsx(O,{weekLabels:c,rectSize:e,space:r,topPad:x}),u.jsx($,{monthLabels:g,rectSize:e,space:r,leftPad:p,colNum:S,rectY:Y,startDate:M}),u.jsx(q,{transform:"translate("+p+", "+x+")",gridNum:S,initStartDate:M,endDate:h,rectProps:f,rectSize:e,rectRender:d,panelColors:j,value:v,space:r})]}))}var U=["prefixCls","className"];function ee(t){var{prefixCls:a="w-heatmap",className:e}=t,l=R(t,U),r=[e,a].filter(Boolean).join(" ");return u.jsx(Q,m({className:r},l))}export{ee as H};
