import{r as D,j as B}from"./react-DShcIP8I.js";import{L as le,T as We,R as $e,U as Ve,B as Xe,M as Ye,C as Ke,a as Je,O as Qe,P as Ze,S as we,b as ce,N as et,A as tt,W as nt,c as rt,d as ot,e as it,V as st,f as te,g as at,h as lt,i as ct}from"./three-DLf2F1tq.js";import{u as ut}from"./react-use-measure-BnmnLuOF.js";import{F as ft,u as dt}from"./its-fine-D32A7Twk.js";import{R as pt,c as J}from"./react-reconciler-f57pm0dR.js";import"./react-dom-xS-mgzEG.js";import{_ as vt}from"./@babel-AtFDC0j3.js";import{O as ht}from"./three-stdlib-BQef9aoS.js";import{c as mt}from"./zustand-DZWWSn2j.js";const gt="modulepreload",yt=function(e){return"/"+e},Ce={},Jt=function(r,i,a){let d=Promise.resolve();if(i&&i.length>0){const h=document.getElementsByTagName("link"),y=document.querySelector("meta[property=csp-nonce]"),g=(y==null?void 0:y.nonce)||(y==null?void 0:y.getAttribute("nonce"));d=Promise.all(i.map(l=>{if(l=yt(l),l in Ce)return;Ce[l]=!0;const v=l.endsWith(".css"),t=v?'[rel="stylesheet"]':"";if(!!a)for(let u=h.length-1;u>=0;u--){const f=h[u];if(f.href===l&&(!v||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${t}`))return;const o=document.createElement("link");if(o.rel=v?"stylesheet":gt,v||(o.as="script",o.crossOrigin=""),o.href=l,g&&o.setAttribute("nonce",g),document.head.appendChild(o),v)return new Promise((u,f)=>{o.addEventListener("load",u),o.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}return d.then(()=>r()).catch(h=>{const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=h,window.dispatchEvent(y),!y.defaultPrevented)throw h})};var xe={exports:{}},Te={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function r(m,S){var w=m.length;m.push(S);e:for(;0<w;){var M=w-1>>>1,L=m[M];if(0<d(L,S))m[M]=S,m[w]=L,w=M;else break e}}function i(m){return m.length===0?null:m[0]}function a(m){if(m.length===0)return null;var S=m[0],w=m.pop();if(w!==S){m[0]=w;e:for(var M=0,L=m.length,A=L>>>1;M<A;){var z=2*(M+1)-1,U=m[z],W=z+1,re=m[W];if(0>d(U,w))W<L&&0>d(re,U)?(m[M]=re,m[W]=w,M=W):(m[M]=U,m[z]=w,M=z);else if(W<L&&0>d(re,w))m[M]=re,m[W]=w,M=W;else break e}}return S}function d(m,S){var w=m.sortIndex-S.sortIndex;return w!==0?w:m.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;e.unstable_now=function(){return h.now()}}else{var y=Date,g=y.now();e.unstable_now=function(){return y.now()-g}}var l=[],v=[],t=1,n=null,o=3,u=!1,f=!1,b=!1,p=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,c=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(m){for(var S=i(v);S!==null;){if(S.callback===null)a(v);else if(S.startTime<=m)a(v),S.sortIndex=S.expirationTime,r(l,S);else break;S=i(v)}}function j(m){if(b=!1,_(m),!f)if(i(l)!==null)f=!0,H(P);else{var S=i(v);S!==null&&q(j,S.startTime-m)}}function P(m,S){f=!1,b&&(b=!1,s(k),k=-1),u=!0;var w=o;try{for(_(S),n=i(l);n!==null&&(!(n.expirationTime>S)||m&&!E());){var M=n.callback;if(typeof M=="function"){n.callback=null,o=n.priorityLevel;var L=M(n.expirationTime<=S);S=e.unstable_now(),typeof L=="function"?n.callback=L:n===i(l)&&a(l),_(S)}else a(l);n=i(l)}if(n!==null)var A=!0;else{var z=i(v);z!==null&&q(j,z.startTime-S),A=!1}return A}finally{n=null,o=w,u=!1}}var C=!1,O=null,k=-1,R=5,T=-1;function E(){return!(e.unstable_now()-T<R)}function x(){if(O!==null){var m=e.unstable_now();T=m;var S=!0;try{S=O(!0,m)}finally{S?F():(C=!1,O=null)}}else C=!1}var F;if(typeof c=="function")F=function(){c(x)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,$=N.port2;N.port1.onmessage=x,F=function(){$.postMessage(null)}}else F=function(){p(x,0)};function H(m){O=m,C||(C=!0,F())}function q(m,S){k=p(function(){m(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(m){m.callback=null},e.unstable_continueExecution=function(){f||u||(f=!0,H(P))},e.unstable_forceFrameRate=function(m){0>m||125<m?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<m?Math.floor(1e3/m):5},e.unstable_getCurrentPriorityLevel=function(){return o},e.unstable_getFirstCallbackNode=function(){return i(l)},e.unstable_next=function(m){switch(o){case 1:case 2:case 3:var S=3;break;default:S=o}var w=o;o=S;try{return m()}finally{o=w}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(m,S){switch(m){case 1:case 2:case 3:case 4:case 5:break;default:m=3}var w=o;o=m;try{return S()}finally{o=w}},e.unstable_scheduleCallback=function(m,S,w){var M=e.unstable_now();switch(typeof w=="object"&&w!==null?(w=w.delay,w=typeof w=="number"&&0<w?M+w:M):w=M,m){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=w+L,m={id:t++,callback:S,priorityLevel:m,startTime:w,expirationTime:L,sortIndex:-1},w>M?(m.sortIndex=w,r(v,m),i(l)===null&&m===i(v)&&(b?(s(k),k=-1):b=!0,q(j,w-M))):(m.sortIndex=L,r(l,m),f||u||(f=!0,H(P))),m},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(m){var S=o;return function(){var w=o;o=S;try{return m.apply(this,arguments)}finally{o=w}}}})(Te);xe.exports=Te;var Ee=xe.exports;const _e={},bt=e=>void Object.assign(_e,e);function _t(e,r){function i(t,{args:n=[],attach:o,...u},f){let b=`${t[0].toUpperCase()}${t.slice(1)}`,p;if(t==="primitive"){if(u.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=u.object;p=Y(s,{type:t,root:f,attach:o,primitive:!0})}else{const s=_e[b];if(!s)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");p=Y(new s(...n),{type:t,root:f,attach:o,memoizedProps:{args:n}})}return p.__r3f.attach===void 0&&(p instanceof Xe?p.__r3f.attach="geometry":p instanceof Ye&&(p.__r3f.attach="material")),b!=="inject"&&de(p,u),p}function a(t,n){let o=!1;if(n){var u,f;(u=n.__r3f)!=null&&u.attach?fe(t,n,n.__r3f.attach):n.isObject3D&&t.isObject3D&&(t.add(n),o=!0),o||(f=t.__r3f)==null||f.objects.push(n),n.__r3f||Y(n,{}),n.__r3f.parent=t,be(n),K(n)}}function d(t,n,o){let u=!1;if(n){var f,b;if((f=n.__r3f)!=null&&f.attach)fe(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){n.parent=t,n.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:n});const p=t.children.filter(c=>c!==n),s=p.indexOf(o);t.children=[...p.slice(0,s),n,...p.slice(s)],u=!0}u||(b=t.__r3f)==null||b.objects.push(n),n.__r3f||Y(n,{}),n.__r3f.parent=t,be(n),K(n)}}function h(t,n,o=!1){t&&[...t].forEach(u=>y(n,u,o))}function y(t,n,o){if(n){var u,f,b;if(n.__r3f&&(n.__r3f.parent=null),(u=t.__r3f)!=null&&u.objects&&(t.__r3f.objects=t.__r3f.objects.filter(j=>j!==n)),(f=n.__r3f)!=null&&f.attach)Re(t,n,n.__r3f.attach);else if(n.isObject3D&&t.isObject3D){var p;t.remove(n),(p=n.__r3f)!=null&&p.root&&Rt(se(n),n)}const c=(b=n.__r3f)==null?void 0:b.primitive,_=!c&&(o===void 0?n.dispose!==null:o);if(!c){var s;h((s=n.__r3f)==null?void 0:s.objects,n,_),h(n.children,n,_)}if(delete n.__r3f,_&&n.dispose&&n.type!=="Scene"){const j=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ee.unstable_scheduleCallback(Ee.unstable_IdlePriority,j):j()}K(t)}}function g(t,n,o,u){var f;const b=(f=t.__r3f)==null?void 0:f.parent;if(!b)return;const p=i(n,o,t.__r3f.root);if(t.children){for(const s of t.children)s.__r3f&&a(p,s);t.children=t.children.filter(s=>!s.__r3f)}t.__r3f.objects.forEach(s=>a(p,s)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||y(b,t),p.parent&&(p.__r3f.autoRemovedBeforeAppend=!0),a(b,p),p.raycast&&p.__r3f.eventCount&&se(p).getState().internal.interaction.push(p),[u,u.alternate].forEach(s=>{s!==null&&(s.stateNode=p,s.ref&&(typeof s.ref=="function"?s.ref(p):s.ref.current=p))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:pt({createInstance:i,removeChild:y,appendChild:a,appendInitialChild:a,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,n)=>{if(!n)return;const o=t.getState().scene;o.__r3f&&(o.__r3f.root=t,a(o,n))},removeChildFromContainer:(t,n)=>{n&&y(t.getState().scene,n)},insertInContainerBefore:(t,n,o)=>{if(!n||!o)return;const u=t.getState().scene;u.__r3f&&d(u,n,o)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var n;return!!((n=t==null?void 0:t.__r3f)!=null?n:{}).handlers},prepareUpdate(t,n,o,u){var f;if(((f=t==null?void 0:t.__r3f)!=null?f:{}).primitive&&u.object&&u.object!==t)return[!0];{const{args:p=[],children:s,...c}=u,{args:_=[],children:j,...P}=o;if(!Array.isArray(p))throw new Error("R3F: the args prop must be an array!");if(p.some((O,k)=>O!==_[k]))return[!0];const C=Be(t,c,P,!0);return C.changes.length?[!1,C]:null}},commitUpdate(t,[n,o],u,f,b,p){n?g(t,u,b,p):de(t,o)},commitMount(t,n,o,u){var f;const b=(f=t.__r3f)!=null?f:{};t.raycast&&b.handlers&&b.eventCount&&se(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>Y(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var n;const{attach:o,parent:u}=(n=t.__r3f)!=null?n:{};o&&u&&Re(u,t,o),t.isObject3D&&(t.visible=!1),K(t)},unhideInstance(t,n){var o;const{attach:u,parent:f}=(o=t.__r3f)!=null?o:{};u&&f&&fe(f,t,u),(t.isObject3D&&n.visible==null||n.visible)&&(t.visible=!0),K(t)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>r?r():J.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:de}}var Pe,Se;const ue=e=>"colorSpace"in e||"outputColorSpace"in e,Le=()=>{var e;return(e=_e.ColorManagement)!=null?e:null},Ae=e=>e&&e.isOrthographicCamera,wt=e=>e&&e.hasOwnProperty("current"),ne=typeof window<"u"&&((Pe=window.document)!=null&&Pe.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?D.useLayoutEffect:D.useEffect;function De(e){const r=D.useRef(e);return ne(()=>void(r.current=e),[e]),r}function Ct({set:e}){return ne(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Ie extends D.Component{constructor(...r){super(...r),this.state={error:!1}}componentDidCatch(r){this.props.set(r)}render(){return this.state.error?null:this.props.children}}Ie.getDerivedStateFromError=()=>({error:!0});const Fe="__default",Me=new Map,Et=e=>e&&!!e.memoized&&!!e.changes;function ze(e){var r;const i=typeof window<"u"?(r=window.devicePixelRatio)!=null?r:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const Z=e=>{var r;return(r=e.__r3f)==null?void 0:r.root.getState()};function se(e){let r=e.__r3f.root;for(;r.getState().previousRoot;)r=r.getState().previousRoot;return r}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,r,{arrays:i="shallow",objects:a="reference",strict:d=!0}={}){if(typeof e!=typeof r||!!e!=!!r)return!1;if(I.str(e)||I.num(e)||I.boo(e))return e===r;const h=I.obj(e);if(h&&a==="reference")return e===r;const y=I.arr(e);if(y&&i==="reference")return e===r;if((y||h)&&e===r)return!0;let g;for(g in e)if(!(g in r))return!1;if(h&&i==="shallow"&&a==="shallow"){for(g in d?r:e)if(!I.equ(e[g],r[g],{strict:d,objects:"reference"}))return!1}else for(g in d?r:e)if(e[g]!==r[g])return!1;if(I.und(g)){if(y&&e.length===0&&r.length===0||h&&Object.keys(e).length===0&&Object.keys(r).length===0)return!0;if(e!==r)return!1}return!0}};function Pt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const r in e)r.dispose==null||r.dispose(),delete e[r]}function Y(e,r){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...r},e}function ye(e,r){let i=e;if(r.includes("-")){const a=r.split("-"),d=a.pop();return i=a.reduce((h,y)=>h[y],e),{target:i,key:d}}else return{target:i,key:r}}const je=/-\d+$/;function fe(e,r,i){if(I.str(i)){if(je.test(i)){const h=i.replace(je,""),{target:y,key:g}=ye(e,h);Array.isArray(y[g])||(y[g]=[])}const{target:a,key:d}=ye(e,i);r.__r3f.previousAttach=a[d],a[d]=r}else r.__r3f.previousAttach=i(e,r)}function Re(e,r,i){var a,d;if(I.str(i)){const{target:h,key:y}=ye(e,i),g=r.__r3f.previousAttach;g===void 0?delete h[y]:h[y]=g}else(a=r.__r3f)==null||a.previousAttach==null||a.previousAttach(e,r);(d=r.__r3f)==null||delete d.previousAttach}function Be(e,{children:r,key:i,ref:a,...d},{children:h,key:y,ref:g,...l}={},v=!1){const t=e.__r3f,n=Object.entries(d),o=[];if(v){const f=Object.keys(l);for(let b=0;b<f.length;b++)d.hasOwnProperty(f[b])||n.unshift([f[b],Fe+"remove"])}n.forEach(([f,b])=>{var p;if((p=e.__r3f)!=null&&p.primitive&&f==="object"||I.equ(b,l[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return o.push([f,b,!0,[]]);let s=[];f.includes("-")&&(s=f.split("-")),o.push([f,b,!1,s]);for(const c in d){const _=d[c];c.startsWith(`${f}-`)&&o.push([c,_,!1,c.split("-")])}});const u={...d};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(u.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(u.attach=t.memoizedProps.attach),{memoized:u,changes:o}}const St=typeof process<"u"&&!1;function de(e,r){var i;const a=e.__r3f,d=a==null?void 0:a.root,h=d==null||d.getState==null?void 0:d.getState(),{memoized:y,changes:g}=Et(r)?r:Be(e,r),l=a==null?void 0:a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=y);for(let t=0;t<g.length;t++){let[n,o,u,f]=g[t];if(ue(e)){const c="srgb",_="srgb-linear";n==="encoding"?(n="colorSpace",o=o===3001?c:_):n==="outputEncoding"&&(n="outputColorSpace",o=o===3001?c:_)}let b=e,p=b[n];if(f.length&&(p=f.reduce((s,c)=>s[c],e),!(p&&p.set))){const[s,...c]=f.reverse();b=c.reverse().reduce((_,j)=>_[j],e),n=s}if(o===Fe+"remove")if(b.constructor){let s=Me.get(b.constructor);s||(s=new b.constructor,Me.set(b.constructor,s)),o=s[n]}else o=0;if(u&&a)o?a.handlers[n]=o:delete a.handlers[n],a.eventCount=Object.keys(a.handlers).length;else if(p&&p.set&&(p.copy||p instanceof le)){if(Array.isArray(o))p.fromArray?p.fromArray(o):p.set(...o);else if(p.copy&&o&&o.constructor&&(St?p.constructor.name===o.constructor.name:p.constructor===o.constructor))p.copy(o);else if(o!==void 0){const s=p instanceof Ke;!s&&p.setScalar?p.setScalar(o):p instanceof le&&o instanceof le?p.mask=o.mask:p.set(o),!Le()&&h&&!h.linear&&s&&p.convertSRGBToLinear()}}else if(b[n]=o,b[n]instanceof We&&b[n].format===$e&&b[n].type===Ve&&h){const s=b[n];ue(s)&&ue(h.gl)?s.colorSpace=h.gl.outputColorSpace:s.encoding=h.gl.outputEncoding}K(e)}if(a&&a.parent&&e.raycast&&l!==a.eventCount){const t=se(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),a.eventCount&&t.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(i=e.__r3f)!=null&&i.parent&&be(e),e}function K(e){var r,i;const a=(r=e.__r3f)==null||(i=r.root)==null||i.getState==null?void 0:i.getState();a&&a.internal.frames===0&&a.invalidate()}function be(e){e.onUpdate==null||e.onUpdate(e)}function Mt(e,r){e.manual||(Ae(e)?(e.left=r.width/-2,e.right=r.width/2,e.top=r.height/2,e.bottom=r.height/-2):e.aspect=r.width/r.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function oe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function jt(){var e;const r=typeof self<"u"&&self||typeof window<"u"&&window;if(!r)return J.DefaultEventPriority;switch((e=r.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return J.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return J.ContinuousEventPriority;default:return J.DefaultEventPriority}}function He(e,r,i,a){const d=i.get(r);d&&(i.delete(r),i.size===0&&(e.delete(a),d.target.releasePointerCapture(a)))}function Rt(e,r){const{internal:i}=e.getState();i.interaction=i.interaction.filter(a=>a!==r),i.initialHits=i.initialHits.filter(a=>a!==r),i.hovered.forEach((a,d)=>{(a.eventObject===r||a.object===r)&&i.hovered.delete(d)}),i.capturedMap.forEach((a,d)=>{He(i.capturedMap,r,a,d)})}function Ot(e){function r(l){const{internal:v}=e.getState(),t=l.offsetX-v.initialClick[0],n=l.offsetY-v.initialClick[1];return Math.round(Math.sqrt(t*t+n*n))}function i(l){return l.filter(v=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return(n=v.__r3f)==null?void 0:n.handlers["onPointer"+t]}))}function a(l,v){const t=e.getState(),n=new Set,o=[],u=v?v(t.internal.interaction):t.internal.interaction;for(let s=0;s<u.length;s++){const c=Z(u[s]);c&&(c.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(l,t);function f(s){const c=Z(s);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var _;c.events.compute==null||c.events.compute(l,c,(_=c.previousRoot)==null?void 0:_.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(s,!0):[]}let b=u.flatMap(f).sort((s,c)=>{const _=Z(s.object),j=Z(c.object);return!_||!j?s.distance-c.distance:j.events.priority-_.events.priority||s.distance-c.distance}).filter(s=>{const c=oe(s);return n.has(c)?!1:(n.add(c),!0)});t.events.filter&&(b=t.events.filter(b,t));for(const s of b){let c=s.object;for(;c;){var p;(p=c.__r3f)!=null&&p.eventCount&&o.push({...s,eventObject:c}),c=c.parent}}if("pointerId"in l&&t.internal.capturedMap.has(l.pointerId))for(let s of t.internal.capturedMap.get(l.pointerId).values())n.has(oe(s.intersection))||o.push(s.intersection);return o}function d(l,v,t,n){const o=e.getState();if(l.length){const u={stopped:!1};for(const f of l){const b=Z(f.object)||o,{raycaster:p,pointer:s,camera:c,internal:_}=b,j=new te(s.x,s.y,0).unproject(c),P=T=>{var E,x;return(E=(x=_.capturedMap.get(T))==null?void 0:x.has(f.eventObject))!=null?E:!1},C=T=>{const E={intersection:f,target:v.target};_.capturedMap.has(T)?_.capturedMap.get(T).set(f.eventObject,E):_.capturedMap.set(T,new Map([[f.eventObject,E]])),v.target.setPointerCapture(T)},O=T=>{const E=_.capturedMap.get(T);E&&He(_.capturedMap,f.eventObject,E,T)};let k={};for(let T in v){let E=v[T];typeof E!="function"&&(k[T]=E)}let R={...f,...k,pointer:s,intersections:l,stopped:u.stopped,delta:t,unprojectedPoint:j,ray:p.ray,camera:c,stopPropagation(){const T="pointerId"in v&&_.capturedMap.get(v.pointerId);if((!T||T.has(f.eventObject))&&(R.stopped=u.stopped=!0,_.hovered.size&&Array.from(_.hovered.values()).find(E=>E.eventObject===f.eventObject))){const E=l.slice(0,l.indexOf(f));h([...E,f])}},target:{hasPointerCapture:P,setPointerCapture:C,releasePointerCapture:O},currentTarget:{hasPointerCapture:P,setPointerCapture:C,releasePointerCapture:O},nativeEvent:v};if(n(R),u.stopped===!0)break}}return l}function h(l){const{internal:v}=e.getState();for(const t of v.hovered.values())if(!l.length||!l.find(n=>n.object===t.object&&n.index===t.index&&n.instanceId===t.instanceId)){const o=t.eventObject.__r3f,u=o==null?void 0:o.handlers;if(v.hovered.delete(oe(t)),o!=null&&o.eventCount){const f={...t,intersections:l};u.onPointerOut==null||u.onPointerOut(f),u.onPointerLeave==null||u.onPointerLeave(f)}}}function y(l,v){for(let t=0;t<v.length;t++){const n=v[t].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(l)}}function g(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>h([]);case"onLostPointerCapture":return v=>{const{internal:t}=e.getState();"pointerId"in v&&t.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(v.pointerId)&&(t.capturedMap.delete(v.pointerId),h([]))})}}return function(t){const{onPointerMissed:n,internal:o}=e.getState();o.lastEvent.current=t;const u=l==="onPointerMove",f=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",p=a(t,u?i:void 0),s=f?r(t):0;l==="onPointerDown"&&(o.initialClick=[t.offsetX,t.offsetY],o.initialHits=p.map(_=>_.eventObject)),f&&!p.length&&s<=2&&(y(t,o.interaction),n&&n(t)),u&&h(p);function c(_){const j=_.eventObject,P=j.__r3f,C=P==null?void 0:P.handlers;if(P!=null&&P.eventCount)if(u){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const O=oe(_),k=o.hovered.get(O);k?k.stopped&&_.stopPropagation():(o.hovered.set(O,_),C.onPointerOver==null||C.onPointerOver(_),C.onPointerEnter==null||C.onPointerEnter(_))}C.onPointerMove==null||C.onPointerMove(_)}else{const O=C[l];O?(!f||o.initialHits.includes(j))&&(y(t,o.interaction.filter(k=>!o.initialHits.includes(k))),O(_)):f&&o.initialHits.includes(j)&&y(t,o.interaction.filter(k=>!o.initialHits.includes(k)))}}d(p,t,s,c)}}return{handlePointer:g}}const Ne=e=>!!(e!=null&&e.render),qe=D.createContext(null),kt=(e,r)=>{const i=mt((g,l)=>{const v=new te,t=new te,n=new te;function o(s=l().camera,c=t,_=l().size){const{width:j,height:P,top:C,left:O}=_,k=j/P;c instanceof te?n.copy(c):n.set(...c);const R=s.getWorldPosition(v).distanceTo(n);if(Ae(s))return{width:j/s.zoom,height:P/s.zoom,top:C,left:O,factor:1,distance:R,aspect:k};{const T=s.fov*Math.PI/180,E=2*Math.tan(T/2)*R,x=E*(j/P);return{width:x,height:E,top:C,left:O,factor:j/x,distance:R,aspect:k}}}let u;const f=s=>g(c=>({performance:{...c.performance,current:s}})),b=new at;return{set:g,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(l(),s),advance:(s,c)=>r(s,c,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new lt,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=l();u&&clearTimeout(u),s.performance.current!==s.performance.min&&f(s.performance.min),u=setTimeout(()=>f(l().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:o},setEvents:s=>g(c=>({...c,events:{...c.events,...s}})),setSize:(s,c,_,j,P)=>{const C=l().camera,O={width:s,height:c,top:j||0,left:P||0,updateStyle:_};g(k=>({size:O,viewport:{...k.viewport,...o(C,t,O)}}))},setDpr:s=>g(c=>{const _=ze(s);return{viewport:{...c.viewport,dpr:_,initialDpr:c.viewport.initialDpr||_}}}),setFrameloop:(s="always")=>{const c=l().clock;c.stop(),c.elapsedTime=0,s!=="never"&&(c.start(),c.elapsedTime=0),g(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:D.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,c,_)=>{const j=l().internal;return j.priority=j.priority+(c>0?1:0),j.subscribers.push({ref:s,priority:c,store:_}),j.subscribers=j.subscribers.sort((P,C)=>P.priority-C.priority),()=>{const P=l().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(c>0?1:0),P.subscribers=P.subscribers.filter(C=>C.ref!==s))}}}}}),a=i.getState();let d=a.size,h=a.viewport.dpr,y=a.camera;return i.subscribe(()=>{const{camera:g,size:l,viewport:v,gl:t,set:n}=i.getState();if(l.width!==d.width||l.height!==d.height||v.dpr!==h){var o;d=l,h=v.dpr,Mt(g,l),t.setPixelRatio(v.dpr);const u=(o=l.updateStyle)!=null?o:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(l.width,l.height,u)}g!==y&&(y=g,n(u=>({viewport:{...u.viewport,...u.viewport.getCurrentViewport(g)}})))}),i.subscribe(g=>e(g)),i};let ie,xt=new Set,Tt=new Set,Lt=new Set;function pe(e,r){if(e.size)for(const{callback:i}of e.values())i(r)}function ee(e,r){switch(e){case"before":return pe(xt,r);case"after":return pe(Tt,r);case"tail":return pe(Lt,r)}}let ve,he;function me(e,r,i){let a=r.clock.getDelta();for(r.frameloop==="never"&&typeof e=="number"&&(a=e-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=e),ve=r.internal.subscribers,ie=0;ie<ve.length;ie++)he=ve[ie],he.ref.current(he.store.getState(),a,i);return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),r.frameloop==="always"?1:r.internal.frames}function At(e){let r=!1,i=!1,a,d,h;function y(v){d=requestAnimationFrame(y),r=!0,a=0,ee("before",v),i=!0;for(const n of e.values()){var t;h=n.store.getState(),h.internal.active&&(h.frameloop==="always"||h.internal.frames>0)&&!((t=h.gl.xr)!=null&&t.isPresenting)&&(a+=me(v,h))}if(i=!1,ee("after",v),a===0)return ee("tail",v),r=!1,cancelAnimationFrame(d)}function g(v,t=1){var n;if(!v)return e.forEach(o=>g(o.store.getState(),t));(n=v.gl.xr)!=null&&n.isPresenting||!v.internal.active||v.frameloop==="never"||(t>1?v.internal.frames=Math.min(60,v.internal.frames+t):i?v.internal.frames=2:v.internal.frames=1,r||(r=!0,requestAnimationFrame(y)))}function l(v,t=!0,n,o){if(t&&ee("before",v),n)me(v,n,o);else for(const u of e.values())me(v,u.store.getState());t&&ee("after",v)}return{loop:y,invalidate:g,advance:l}}function Ue(){const e=D.useContext(qe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function G(e=i=>i,r){return Ue()(e,r)}function Dt(e,r=0){const i=Ue(),a=i.getState().internal.subscribe,d=De(e);return ne(()=>a(d,r,i),[r,a,i]),null}const Q=new Map,{invalidate:Oe,advance:ke}=At(Q),{reconciler:ae,applyProps:V}=_t(Q,jt),X={objects:"shallow",strict:!1},It=(e,r)=>{const i=typeof e=="function"?e(r):e;return Ne(i)?i:new nt({powerPreference:"high-performance",canvas:r,antialias:!0,alpha:!0,...e})};function Ft(e,r){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(r){const{width:a,height:d,top:h,left:y,updateStyle:g=i}=r;return{width:a,height:d,top:h,left:y,updateStyle:g}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:a,height:d,top:h,left:y}=e.parentElement.getBoundingClientRect();return{width:a,height:d,top:h,left:y,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function zt(e){const r=Q.get(e),i=r==null?void 0:r.fiber,a=r==null?void 0:r.store;r&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,h=a||kt(Oe,ke),y=i||ae.createContainer(h,J.ConcurrentRoot,null,!1,null,"",d,null);r||Q.set(e,{fiber:y,store:h});let g,l=!1,v;return{configure(t={}){let{gl:n,size:o,scene:u,events:f,onCreated:b,shadows:p=!1,linear:s=!1,flat:c=!1,legacy:_=!1,orthographic:j=!1,frameloop:P="always",dpr:C=[1,2],performance:O,raycaster:k,camera:R,onPointerMissed:T}=t,E=h.getState(),x=E.gl;E.gl||E.set({gl:x=It(n,e)});let F=E.raycaster;F||E.set({raycaster:F=new Je});const{params:N,...$}=k||{};if(I.equ($,F,X)||V(F,{...$}),I.equ(N,F.params,X)||V(F,{params:{...F.params,...N}}),!E.camera||E.camera===v&&!I.equ(v,R,X)){v=R;const w=R instanceof rt,M=w?R:j?new Qe(0,0,0,0,.1,1e3):new Ze(75,0,.1,1e3);w||(M.position.z=5,R&&(V(M,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(M.manual=!0,M.updateProjectionMatrix())),!E.camera&&!(R!=null&&R.rotation)&&M.lookAt(0,0,0)),E.set({camera:M}),F.camera=M}if(!E.scene){let w;u instanceof we?w=u:(w=new we,u&&V(w,u)),E.set({scene:Y(w)})}if(!E.xr){var H;const w=(A,z)=>{const U=h.getState();U.frameloop!=="never"&&ke(A,!0,U,z)},M=()=>{const A=h.getState();A.gl.xr.enabled=A.gl.xr.isPresenting,A.gl.xr.setAnimationLoop(A.gl.xr.isPresenting?w:null),A.gl.xr.isPresenting||Oe(A)},L={connect(){const A=h.getState().gl;A.xr.addEventListener("sessionstart",M),A.xr.addEventListener("sessionend",M)},disconnect(){const A=h.getState().gl;A.xr.removeEventListener("sessionstart",M),A.xr.removeEventListener("sessionend",M)}};typeof((H=x.xr)==null?void 0:H.addEventListener)=="function"&&L.connect(),E.set({xr:L})}if(x.shadowMap){const w=x.shadowMap.enabled,M=x.shadowMap.type;if(x.shadowMap.enabled=!!p,I.boo(p))x.shadowMap.type=ce;else if(I.str(p)){var q;const L={basic:ot,percentage:it,soft:ce,variance:st};x.shadowMap.type=(q=L[p])!=null?q:ce}else I.obj(p)&&Object.assign(x.shadowMap,p);(w!==x.shadowMap.enabled||M!==x.shadowMap.type)&&(x.shadowMap.needsUpdate=!0)}const m=Le();m&&("enabled"in m?m.enabled=!_:"legacyMode"in m&&(m.legacyMode=_)),l||V(x,{outputEncoding:s?3e3:3001,toneMapping:c?et:tt}),E.legacy!==_&&E.set(()=>({legacy:_})),E.linear!==s&&E.set(()=>({linear:s})),E.flat!==c&&E.set(()=>({flat:c})),n&&!I.fun(n)&&!Ne(n)&&!I.equ(n,x,X)&&V(x,n),f&&!E.events.handlers&&E.set({events:f(h)});const S=Ft(e,o);return I.equ(S,E.size,X)||E.setSize(S.width,S.height,S.updateStyle,S.top,S.left),C&&E.viewport.dpr!==ze(C)&&E.setDpr(C),E.frameloop!==P&&E.setFrameloop(P),E.onPointerMissed||E.set({onPointerMissed:T}),O&&!I.equ(O,E.performance,X)&&E.set(w=>({performance:{...w.performance,...O}})),g=b,l=!0,this},render(t){return l||this.configure(),ae.updateContainer(B.jsx(Bt,{store:h,children:t,onCreated:g,rootElement:e}),y,null,()=>{}),h},unmount(){Ge(e)}}}function Bt({store:e,children:r,onCreated:i,rootElement:a}){return ne(()=>{const d=e.getState();d.set(h=>({internal:{...h.internal,active:!0}})),i&&i(d),e.getState().events.connected||d.events.connect==null||d.events.connect(a)},[]),B.jsx(qe.Provider,{value:e,children:r})}function Ge(e,r){const i=Q.get(e),a=i==null?void 0:i.fiber;if(a){const d=i==null?void 0:i.store.getState();d&&(d.internal.active=!1),ae.updateContainer(null,a,null,()=>{d&&setTimeout(()=>{try{var h,y,g,l;d.events.disconnect==null||d.events.disconnect(),(h=d.gl)==null||(y=h.renderLists)==null||y.dispose==null||y.dispose(),(g=d.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),(l=d.gl)!=null&&l.xr&&d.xr.disconnect(),Pt(d),Q.delete(e),r&&r(e)}catch{}},500)})}}ae.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:D.version});const ge={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Ht(e){const{handlePointer:r}=Ot(e);return{priority:1,enabled:!0,compute(i,a,d){a.pointer.set(i.offsetX/a.size.width*2-1,-(i.offsetY/a.size.height)*2+1),a.raycaster.setFromCamera(a.pointer,a.camera)},connected:void 0,handlers:Object.keys(ge).reduce((i,a)=>({...i,[a]:r(a)}),{}),update:()=>{var i;const{events:a,internal:d}=e.getState();(i=d.lastEvent)!=null&&i.current&&a.handlers&&a.handlers.onPointerMove(d.lastEvent.current)},connect:i=>{var a;const{set:d,events:h}=e.getState();h.disconnect==null||h.disconnect(),d(y=>({events:{...y.events,connected:i}})),Object.entries((a=h.handlers)!=null?a:[]).forEach(([y,g])=>{const[l,v]=ge[y];i.addEventListener(l,g,{passive:v})})},disconnect:()=>{const{set:i,events:a}=e.getState();if(a.connected){var d;Object.entries((d=a.handlers)!=null?d:[]).forEach(([h,y])=>{if(a&&a.connected instanceof HTMLElement){const[g]=ge[h];a.connected.removeEventListener(g,y)}}),i(h=>({events:{...h.events,connected:void 0}}))}}}}const Nt=D.forwardRef(function({children:r,fallback:i,resize:a,style:d,gl:h,events:y=Ht,eventSource:g,eventPrefix:l,shadows:v,linear:t,flat:n,legacy:o,orthographic:u,frameloop:f,dpr:b,performance:p,raycaster:s,camera:c,scene:_,onPointerMissed:j,onCreated:P,...C},O){D.useMemo(()=>bt(ct),[]);const k=dt(),[R,T]=ut({scroll:!0,debounce:{scroll:50,resize:0},...a}),E=D.useRef(null),x=D.useRef(null);D.useImperativeHandle(O,()=>E.current);const F=De(j),[N,$]=D.useState(!1),[H,q]=D.useState(!1);if(N)throw N;if(H)throw H;const m=D.useRef(null);ne(()=>{const w=E.current;T.width>0&&T.height>0&&w&&(m.current||(m.current=zt(w)),m.current.configure({gl:h,events:y,shadows:v,linear:t,flat:n,legacy:o,orthographic:u,frameloop:f,dpr:b,performance:p,raycaster:s,camera:c,scene:_,size:T,onPointerMissed:(...M)=>F.current==null?void 0:F.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(g?wt(g)?g.current:g:x.current),l&&M.setEvents({compute:(L,A)=>{const z=L[l+"X"],U=L[l+"Y"];A.pointer.set(z/A.size.width*2-1,-(U/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),P==null||P(M)}}),m.current.render(B.jsx(k,{children:B.jsx(Ie,{set:q,children:B.jsx(D.Suspense,{fallback:B.jsx(Ct,{set:$}),children:r})})})))}),D.useEffect(()=>{const w=E.current;if(w)return()=>Ge(w)},[]);const S=g?"none":"auto";return B.jsx("div",{ref:x,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:S,...d},...C,children:B.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:E,style:{display:"block"},children:i})})})}),Qt=D.forwardRef(function(r,i){return B.jsx(ft,{children:B.jsx(Nt,{...r,ref:i})})}),Zt=D.forwardRef(({makeDefault:e,camera:r,regress:i,domElement:a,enableDamping:d=!0,keyEvents:h=!1,onChange:y,onStart:g,onEnd:l,...v},t)=>{const n=G(C=>C.invalidate),o=G(C=>C.camera),u=G(C=>C.gl),f=G(C=>C.events),b=G(C=>C.setEvents),p=G(C=>C.set),s=G(C=>C.get),c=G(C=>C.performance),_=r||o,j=a||f.connected||u.domElement,P=D.useMemo(()=>new ht(_),[_]);return Dt(()=>{P.enabled&&P.update()},-1),D.useEffect(()=>(h&&P.connect(h===!0?j:h),P.connect(j),()=>void P.dispose()),[h,j,i,P,n]),D.useEffect(()=>{const C=R=>{n(),i&&c.regress(),y&&y(R)},O=R=>{g&&g(R)},k=R=>{l&&l(R)};return P.addEventListener("change",C),P.addEventListener("start",O),P.addEventListener("end",k),()=>{P.removeEventListener("start",O),P.removeEventListener("end",k),P.removeEventListener("change",C)}},[y,g,l,P,n,b]),D.useEffect(()=>{if(e){const C=s().controls;return p({controls:P}),()=>p({controls:C})}},[e,P]),D.createElement("primitive",vt({ref:t,object:P,enableDamping:d},v))});export{Qt as C,Zt as O,Jt as _,bt as e,G as u};
