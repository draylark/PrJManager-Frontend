function T(t){let e=0;for(let n=0;n<t.length;++n)t[n]==="&"&&++e;return e}const A=/\s*,(?![^(]*\))\s*/g,_=/\s+/g;function j(t,e){const n=[];return e.split(A).forEach(r=>{let u=T(r);if(u){if(u===1){t.forEach(o=>{n.push(r.replace("&",o))});return}}else{t.forEach(o=>{n.push((o&&o+" ")+r)});return}let f=[r];for(;u--;){const o=[];f.forEach(i=>{t.forEach(s=>{o.push(i.replace("&",s))})}),f=o}f.forEach(o=>n.push(o))}),n}function R(t,e){const n=[];return e.split(A).forEach(r=>{t.forEach(u=>{n.push((u&&u+" ")+r)})}),n}function S(t){let e=[""];return t.forEach(n=>{n=n&&n.trim(),n&&(n.includes("&")?e=j(e,n):e=R(e,n))}),e.join(", ").replace(_," ")}const k=/[A-Z]/g;function w(t){return t.replace(k,e=>"-"+e.toLowerCase())}function q(t,e="  "){return typeof t=="object"&&t!==null?` {
`+Object.entries(t).map(n=>e+`  ${w(n[0])}: ${n[1]};`).join(`
`)+`
`+e+"}":`: ${t};`}function B(t,e,n){return typeof t=="function"?t({context:e.context,props:n}):t}function C(t,e,n,r){if(!e)return"";const u=B(e,n,r);if(!u)return"";if(typeof u=="string")return`${t} {
${u}
}`;const f=Object.keys(u);if(f.length===0)return n.config.keepEmptyBlock?t+` {
}`:"";const o=t?[t+" {"]:[];return f.forEach(i=>{const s=u[i];if(i==="raw"){o.push(`
`+s+`
`);return}i=w(i),s!=null&&o.push(`  ${i}${q(s)}`)}),t&&o.push("}"),o.join(`
`)}function y(t,e,n){t&&t.forEach(r=>{if(Array.isArray(r))y(r,e,n);else if(typeof r=="function"){const u=r(e);Array.isArray(u)?y(u,e,n):u&&n(u)}else r&&n(r)})}function b(t,e,n,r,u,f){const o=t.$;!o||typeof o=="string"?e.push(o):typeof o=="function"?e.push(o({context:r.context,props:u})):(o.before&&o.before(r.context),!o.$||typeof o.$=="string"?e.push(o.$):o.$&&e.push(o.$({context:r.context,props:u})));const i=S(e),s=C(i,t.props,r,u);f&&s&&f.insertRule(s),!f&&s.length&&n.push(s),t.children&&y(t.children,{context:r.context,props:u},c=>{if(typeof c=="string"){const h=C(i,{raw:c},r,u);f?f.insertRule(h):n.push(h)}else b(c,e,n,r,u,f)}),e.pop(),o&&o.after&&o.after(r.context)}function $(t,e,n,r=!1){const u=[];return b(t,[],u,e,n,r?t.instance.__styleSheet:void 0),r?"":u.join(`

`)}function L(t){for(var e=0,n,r=0,u=t.length;u>=4;++r,u-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(u){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}function x(t){if(!t)return;const e=t.parentElement;e&&e.removeChild(t)}function g(t){return document.querySelector(`style[cssr-id="${t}"]`)}function N(t){const e=document.createElement("style");return e.setAttribute("cssr-id",t),e}window&&(window.__cssrContext={});function v(t){const e=t.getAttribute("mount-count");return e===null?null:Number(e)}function p(t,e){t.setAttribute("mount-count",String(e))}function E(t,e,n,r){const{els:u}=e;if(n===void 0)u.forEach(x),e.els=[];else{const f=g(n);if(f&&u.includes(f)){const o=v(f);r?o===null?console.error(`[css-render/unmount]: The style with target='${n}' is mounted in count mode.`):o<=1?(x(f),e.els=u.filter(i=>i!==f)):p(f,o-1):o!==null?console.error(`[css-render/unmount]: The style with target='${n}' is mounted in no-count mode.`):(x(f),e.els=u.filter(i=>i!==f))}}}function O(t,e){t.push(e)}function W(t,e,n,r,u,f,o,i,s){if(o&&!s){if(n===void 0){console.error("[css-render/mount]: `id` is required in `boost` mode.");return}const d=window.__cssrContext;d[n]||(d[n]=!0,$(e,t,r,o));return}let c;const{els:h}=e;let a;if(n===void 0&&(a=e.render(r),n=L(a)),s){s(n,a??e.render(r));return}const l=g(n);if(i||l===null){if(c=l===null?N(n):l,a===void 0&&(a=e.render(r)),c.textContent=a,l!==null)return;if(u){const d=document.head.getElementsByTagName("style")[0]||null;document.head.insertBefore(c,d)}else document.head.appendChild(c);f&&p(c,1),O(h,c)}else{const d=v(l);f?d===null?console.error(`[css-render/mount]: The style with id='${n}' has been mounted in no-count mode.`):p(l,d+1):d!==null&&console.error(`[css-render/mount]: The style with id='${n}' has been mounted in count mode.`)}return l??c}function M(t){return $(this,this.instance,t)}function U(t={}){const{target:e,id:n,ssr:r,props:u,count:f=!1,head:o=!1,boost:i=!1,force:s=!1}=t;return W(this.instance,this,n??e,u,o,f,i,s,r)}function Z(t={}){const{id:e,target:n,delay:r=0,count:u=!1}=t;r===0?E(this.instance,this,e??n,u):setTimeout(()=>E(this.instance,this,e??n,u),r)}const m=function(t,e,n,r){return{instance:t,$:e,props:n,children:r,els:[],render:M,mount:U,unmount:Z}},z=function(t,e,n,r){return Array.isArray(e)?m(t,{$:null},null,e):Array.isArray(n)?m(t,e,null,n):Array.isArray(r)?m(t,e,n,r):m(t,e,n,null)};function D(t={}){let e=null;const n={c:(...r)=>z(n,...r),use:(r,...u)=>r.install(n,...u),find:g,context:{},config:t,get __styleSheet(){if(!e){const r=document.createElement("style");return document.head.appendChild(r),e=document.styleSheets[document.styleSheets.length-1],e}return e}};return n}export{D as C};
