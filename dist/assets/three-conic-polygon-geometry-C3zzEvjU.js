import{B as ae,F as ie}from"./three-DLf2F1tq.js";import{e as z}from"./earcut-YjIu_wux.js";import{D as ue}from"./delaunator-CzPOmzqK.js";import{b as fe}from"./@turf-kq6v_4Ky.js";import{m as K,e as Y,d as se}from"./d3-array-DW6NUCqg.js";import{d as re,e as ce,c as le,f as ve}from"./d3-geo-8K_4ySTE.js";import{g as me}from"./d3-geo-voronoi-B2d7j4wn.js";import{l as Z}from"./d3-scale-B6uunQkx.js";function ge(e,r,t){return r=N(r),we(e,te()?Reflect.construct(r,t||[],N(e).constructor):r.apply(e,t))}function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(te=function(){return!!e})()}function pe(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,o,f,u,a=[],s=!0,i=!1;try{if(f=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;s=!1}else for(;!(s=(n=f.call(t)).done)&&(a.push(n.value),a.length!==r);s=!0);}catch(m){i=!0,o=m}finally{try{if(!s&&t.return!=null&&(u=t.return(),Object(u)!==u))return}finally{if(i)throw o}}return a}}function ye(e,r){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function de(e){var r=ye(e,"string");return typeof r=="symbol"?r:String(r)}function he(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function D(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,de(n.key),n)}}function be(e,r,t){return r&&D(e.prototype,r),t&&D(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _e(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&H(e,r)}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},N(e)}function H(e,r){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},H(e,r)}function Pe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,r){if(r&&(typeof r=="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pe(e)}function A(e,r){return Le(e)||pe(e,r)||ne(e,r)||je()}function q(e){return Ae(e)||Oe(e)||ne(e)||Me()}function Ae(e){if(Array.isArray(e))return J(e)}function Le(e){if(Array.isArray(e))return e}function Oe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ne(e,r){if(e){if(typeof e=="string")return J(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return J(e,r)}}function J(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Me(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function je(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Be(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.resolution,n=t===void 0?1/0:t,o=Ee(e,n),f=K(o),u=Ie(e,n),a=[].concat(q(f),q(u)),s={type:"Polygon",coordinates:e},i=re(s),m=A(i,2),_=A(m[0],2),P=_[0],S=_[1],p=A(m[1],2),j=p[0],c=p[1],d=P>j||c>=89||S<=-89,B=[];if(d){var R=me(a).triangles(),U=new Map(a.map(function(l,b){var y=A(l,2),v=y[0],M=y[1];return["".concat(v,"-").concat(M),b]}));R.features.forEach(function(l){var b,y=l.geometry.coordinates[0].slice(0,3).reverse(),v=[];if(y.forEach(function(k){var w=A(k,2),W=w[0],oe=w[1],X="".concat(W,"-").concat(oe);U.has(X)&&v.push(U.get(X))}),v.length===3){if(v.some(function(k){return k<f.length})){var M=l.properties.circumcenter;if(!Q(M,s,d))return}(b=B).push.apply(b,v)}})}else if(u.length)for(var O=ue.from(a),I=function(b){var y,v=[2,1,0].map(function(w){return O.triangles[b+w]}),M=v.map(function(w){return a[w]});if(v.some(function(w){return w<f.length})){var k=[0,1].map(function(w){return se(M,function(W){return W[w]})});if(!Q(k,s,d))return 1}(y=B).push.apply(y,q(v))},T=0,h=O.triangles.length;T<h;T+=3)I(T);else{var C=z.flatten(o),L=C.vertices,g=C.holes,E=g===void 0?[]:g;B=z(L,E,2)}var V=Z(Y(a,function(l){return l[0]}),[0,1]),x=Z(Y(a,function(l){return l[1]}),[0,1]),F=a.map(function(l){var b=A(l,2),y=b[0],v=b[1];return[V(y),x(v)]}),G={points:a,indices:B,uvs:F};return{contour:o,triangles:G}}function Ee(e,r){return e.map(function(t){var n=[],o;return t.forEach(function(f){if(o){var u=le(f,o)*180/Math.PI;if(u>r)for(var a=ve(o,f),s=1/Math.ceil(u/r),i=s;i<1;)n.push(a(i)),i+=s}n.push(o=f)}),n})}function Ie(e,r){var t={type:"Polygon",coordinates:e},n=re(t),o=A(n,2),f=A(o[0],2),u=f[0],a=f[1],s=A(o[1],2),i=s[0],m=s[1];if(Math.min(Math.abs(i-u),Math.abs(m-a))<r)return[];var _=u>i||m>=89||a<=-89;return Te(r,{minLng:u,maxLng:i,minLat:a,maxLat:m}).filter(function(P){return Q(P,t,_)})}function Te(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.minLng,n=r.maxLng,o=r.minLat,f=r.maxLat,u=Math.round(Math.pow(360/e,2)/Math.PI),a=(1+Math.sqrt(5))/2,s=function(d){return d/a*360%360-180},i=function(d){return Math.acos(2*d/u-1)/Math.PI*180-90},m=function(d){return u*(Math.cos((d+90)*Math.PI/180)+1)/2},_=[f!==void 0?Math.ceil(m(f)):0,o!==void 0?Math.floor(m(o)):u-1],P=t===void 0&&n===void 0?function(){return!0}:t===void 0?function(c){return c<=n}:n===void 0?function(c){return c>=t}:n>=t?function(c){return c>=t&&c<=n}:function(c){return c>=t||c<=n},S=[],p=_[0];p<=_[1];p++){var j=s(p);P(j)&&S.push([j,i(p)])}return S}function Q(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return t?ce(r,e):fe(e,r)}var $=window.THREE?window.THREE:{BufferGeometry:ae,Float32BufferAttribute:ie},ee=new $.BufferGeometry().setAttribute?"setAttribute":"addAttribute",$e=function(e){_e(r,e);function r(t,n,o,f,u,a,s){var i;he(this,r),i=ge(this,r),i.type="ConicPolygonBufferGeometry",i.parameters={polygonGeoJson:t,startHeight:n,endHeight:o,closedBottom:f,closedTop:u,includeSides:a,curvatureResolution:s},n=n||0,o=o||1,f=f!==void 0?f:!0,u=u!==void 0?u:!0,a=a!==void 0?a:!0,s=s||5;var m=Be(t,{resolution:s}),_=m.contour,P=m.triangles,S=K(P.uvs),p=[],j=[],c=[],d=0,B=function(g){var E=Math.round(p.length/3),O=c.length;p=p.concat(g.vertices),j=j.concat(g.uvs),c=c.concat(E?g.indices.map(function(I){return I+E}):g.indices),i.addGroup(O,c.length-O,d++)};a&&B(U()),f&&B(C(n,!1)),u&&B(C(o,!0)),i.setIndex(c),i[ee]("position",new $.Float32BufferAttribute(p,3)),i[ee]("uv",new $.Float32BufferAttribute(j,2)),i.computeVertexNormals();function R(L,g){var E=L.map(function(O){return O.map(function(I){var T=A(I,2),h=T[0],V=T[1];return Ge(V,h,g)})});return z.flatten(E)}function U(){for(var L=R(_,n),g=L.vertices,E=L.holes,O=R(_,o),I=O.vertices,T=K([I,g]),h=Math.round(I.length/3),V=new Set(E),x=0,F=[],G=0;G<h;G++){var l=G+1;if(l===h)l=x;else if(V.has(l)){var b=l;l=x,x=b}F.push(G,G+h,l+h),F.push(l+h,l,G)}for(var y=[],v=1;v>=0;v--)for(var M=0;M<h;M+=1)y.push(M/(h-1),v);return{indices:F,vertices:T,uvs:y}}function C(L){var g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:g?P.indices:P.indices.slice().reverse(),vertices:R([P.points],L).vertices,uvs:S}}return i}return be(r)}($.BufferGeometry);function Ge(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(90-e)*Math.PI/180,o=(90-r)*Math.PI/180;return[t*Math.sin(n)*Math.cos(o),t*Math.cos(n),t*Math.sin(n)*Math.sin(o)]}export{$e as C};
